stepback: true

modules:
  - name: spruce
    owner: evergreen-ci
    repo: spruce
    branch: main
    auto_update: true
  - name: ui
    owner: evergreen-ci
    repo: ui
    branch: main
    auto_update: true

buildvariants:
    - display_name: Tests
      name: ubuntu
      run_on:
          - ubuntu2204-small
      modules:
          - spruce
          - ui
      tasks:
          - name: first-task
          - name: another-task
          - name: long-task
          - name: short-task
          - name: oops-another-task
          - name: noise-task-1
          - name: noise-task-2
          - name: noise-task-3
          - name: generator
          - name: clone-test

functions:
    clone-project:
        - command: git.get_project
          type: setup
          params:
              directory: src
    clone-project-and-modules:
        - command: git.get_project
          type: setup
          params:
              directory: src
              revisions:
                  spruce: ${spruce}
                  ui: ${ui}

tasks:
    - name: first-task
      commands:
          - command: shell.exec
            params:
                script: |
                    echo "Task"
                    exit 1 #1
    - name: another-task
      commands:
          - command: shell.exec
            params:
                script: |
                    echo "Task"
                    exit 1 #2
    - name: long-task
      commands:
          - command: shell.exec
            params:
                script: |
                    echo "Task"
                    exit 1 #8
    - name: short-task
      commands:
          - command: shell.exec
            params:
                script: |
                    echo "Task"
                    exit 1 #5
    - name: oops-another-task
      commands:
          - command: shell.exec
            params:
                script: |
                    echo "Task"
                    exit 1 #7
    - name: noise-task-1
      commands:
          - command: shell.exec
            params:
                script: |
                    echo "Task"
                    exit 0
    - name: noise-task-2
      commands:
          - command: shell.exec
            params:
                script: |
                    echo "Task"
                    exit 0
    - name: noise-task-3
      commands:
          - command: shell.exec
            params:
                script: |
                    echo "Task"
                    exit 0
    - name: generator
      commands:
          - func: clone-project
          - command: generate.tasks
            params:
                files:
                    - src/generator.json
    - name: clone-source
      commands:
          - func: clone-project
    - name: clone-module
      commands:
          - func: clone-project-and-modules
